## 1. 概述
- 模型目标：进行词的向量化表示
- 输入：语料库
- 输出：词向量
- 方法概述：首先基于语料构建词的共现矩阵【其中每个元素$x_{ij}$表示，词$x_i$作为中心词时，词$x_j$作为周围词出现的次数，所以$x_{ij}$并不等于$x_{ji}$，共现矩阵不是一个对称矩阵】，然后基于共现矩阵和Glove模型学习词向量。

## 2.统计共现矩阵
设共现矩阵为$X$，其元素为$X_{ij}$。
$X_{ij}$的意义为：在整个语料库中，单词$i$和单词$j$共同出现在一个窗口中的次数。
假设有如下语料库：
- i love you but you love him i an sad

这个语料库只有一个句子，涉及到7个单词：i, love, you, but, him, an, sad;
如果我们采取一个窗口为5（左右长度都为2）的统计窗口，那么就有以下窗口的内容：
![](../figure/68.png)

窗口0、1的长度小于5是因为中心词左侧内容少于2，同理窗口8，9长度也小于5.
以窗口5为例说明如何构造共现矩阵，中心词为love，语境词为but,you,him,i,则执行：
$$\begin{aligned}
    X_{love,but} += & 1\\
    X_{love,you} += & 1\\
    X_{love,him} += & 1\\
    X_{love,i} += & 1
\end{aligned}$$

使用窗口将整个语料库遍历一遍，即可以得到共现矩阵$X$。

## 3.使用Glove模型训练词向量
先看下模型的代价函数，如下：
$$J = \sum_{i,j}^Nf(X_{ij})(v_i^Tv_j + b_i + b_j - log(X_{ij}))^2 $$
其中$v_i,v_j$是单词$i$和单词$j$的词向量，$b_i,b_j$是两个标量（作者定义的偏差项），$f$是权重函数（主要是针对不同的词应该有不同的权重而设计的），N是词汇表的大小（共现矩阵的维度为N*N）。
**可以看到，Glove模型没有使用神经网络的方法。**

### 3.1模型怎么来的
首先我们先定义几个符号。
矩阵单词$i$那一行的和：
$$X_i = \sum_{j=1}^{N}X_{i,j}$$
条件概率，用来表示单词$k$在单词$i$的语境中出现的概率：
$P_{i,k} = \frac{X_{i,k}}{X_i}$
条件概率的比率：
$$ratio_{i,j,k} = \frac{P_{i,k}}{P_{j,k}}$$
这样定义的原因主要是作者发现，$ratio_{i,j,k}$这个指标是有规律的，规律统计在下表中：
![](../figure/69.png)
很简单，但是是很有用的规律。

**思想：假设我们已经得到了词向量，如果我们用词向量$v_i,v_j,v_k$通过某种函数计算$ratio_{i,j,k}$，同样能够得到规律的话，就意味着我们的词向量与共现矩阵具有很好的一致性，也就是说明我们的词向量中蕴含了共现矩阵中所蕴含的信息。**

设用词向量$v_i,v_j,v_k$计算$ratio_{i,j,k}$的函数为$g(v_i,v_j,v_k)$，那么应该有：
$$\frac{P_{i,k}}{P_{j,k}} = ratio_{i,j,k} = g(v_i,v_j,v_k)$$

即：
$$\frac{P_{i,k}}{P_{j,k}} = g(v_i,v_j,v_k)$$
即二者应该尽可能的接近。
很容易的想到用二者的方差来作为代价函数：
$$J = \sum_{i,j,k}^{N}(\frac{P_{i,k}}{P_{j,k}}- g(v_i,v_j,v_k) )^2$$
但是仔细一看，模型中包含了3个单词，这就意味着要在$N*N*N$的复杂度上进行计算，太复杂了，我们希望复杂度能低一点。

接下来，我们来思考$g(v_i,v_j,v_k)$，希望它能帮上忙；
作者的脑洞是这样的：
1. 要考虑单词$i$和单词$j$之间的关系，那$g(v_i,v_j,v_k)$中大概要有这么一项：$v_i - v_j$。
2. $ratio_{i,j,k}$是个标量，那么$g(v_i,v_j,v_k)$最后也应该是个标量，那么可以设置成:$(v_i - v_j)^Tv_k$。
3. 然后作者又往$(v_i -v_j)^Tv_k$的外面套上一层指数运算$exp()$，得到最终的$g(v_i,v_j,v_k) = exp((v_i - v_j)^Tv_k)$.

最关键的第三步，为什么套了一层$exp()?$
套上之后，我们的目标是让以下公式尽可能的成立：
$$\frac{P_{i,k}}{P_{j,k}} = g(v_i,v_j,v_k)$$
即：
$$\frac{P_{i,k}}{P_{j,k}} = exp((v_i -v_j)^Tv_k)$$
即：
$$\frac{P_{i,k}}{P_{j,k}} = exp(v_i^Tv_k - v_j^Tv_k)$$
即：
$$\frac{P_{i,k}}{P_{j,k}} = \frac{exp(v_i^Tv_k)}{exp(v_j^Tv_k)}$$

然后，我们就发现找到极简化的方法了：只需要让上式分子对应相等，分母对应相等，即：
$$P_{i,k} = exp(v_i^Tv_k)并且P_{j,k} = exp(v_j^Tv_k) $$

可以发现分子分母的形式相同，就可以把两者统一考虑了，即：
$$P_{i,j} = exp(v_i^Tv_j)$$

本来我们追求：
$$\frac{P_{i,k}}{P_{j,k}} = g(v_i,v_j,v_k)$$
现在我们只需追求：
$$P_{i,j} = exp(v_i^Tv_j)$$
两边取个对数，我们就可以求得：
$$log(P_{ij}) = v_i^Tv_j$$

那么代价函数就可以简化为：
$$J = \sum_{i,j}^N(log(P_{i,j}) - v_i^Tv_j)^2$$
现在只需要在$N*N$上进行计算了，而不是$N*N*N$上。
但是目前仍然存在一个问题，也就是下面两个式子：
$$log(P_{i,j})=v_i^Tv_j和log(P_{j,i})=v_j^Tv_i$$
其中$log(P_{i,j})$不等于$log(P_{j,i})$，而$v_i^Tv_j$等于$v_j^Tv_i$，即等式左边不具备对称性，但是等式右边具有对称性。
现在可以将代价函数中的条件概率展开可得：
$$log(P_{i,j}) = v_i^Tv_j$$
即为：
$$log(X_{i,j}) - log(X_i) = v_i^Tv_j$$
将其变为：
$$log(X_{i,j}) = v_i^Tv_j + b_i + b_j$$
即添加了一个偏差项$b_j$，并将$log(X_i)$吸收到偏差项$b_i$中了。
于是代价函数就变成了：
$$J = \sum_{i,j}^N f(X_{i,j})(v_i^Tv_j + b_i + b_j -log(X_{i,j}))^2 $$
具体的权重函数，需要满足高频词的权重大，但是权重也不能无线增大，所以具体的权重函数的计算方法如下：
$$f(x) = 
\begin{cases}
    (x/xmax)^{0.75}, \qquad &if\quad x < xmax; \\
    1, \qquad &if\quad x>= xmax;
\end{cases}$$
至此，整个Glove模型的计算过程推导完毕。